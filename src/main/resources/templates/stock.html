<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Symbols</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="/jquery.js"></script>
    <link rel="stylesheet" href="/simplePagination.css"/>
    <script src="/jquery.simplePagination.js"></script>
    <style>
        .table-actions button {
            padding: 2px 10px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h3>Stock Symbols</h3>
    <div class="row mb-3">
        <div class="col-md-6">
            <input type="text" id="searchInput" class="form-control" placeholder="Search symbol or description...">
        </div>
        <div class="col-md-2">
            <select id="limitSelect" class="form-control">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
    </div>

    <table class="table table-bordered table-hover">
        <thead class="thead-dark">
        <tr>
            <th class="text-center">Symbol</th>
            <th class="text-center">Description</th>
            <th class="text-center">Currency</th>
            <th class="text-center">Action</th>
        </tr>
        </thead>
        <tbody id="symbolTableBody">
        </tbody>
    </table>

    <nav>
        <div id="pagination" class="pb-5"></div>
    </nav>
</div>

<script>
    function loadSymbols(page = 0) {
        const keyword = $('#searchInput').val();
        const limit = $('#limitSelect').val();

        $.get(`/api/stocks/symbols?page=${page}&size=${limit}&q=${keyword}`, function (res) {
            const tbody = $('#symbolTableBody');
            tbody.empty();
            const symbols = res.data

            for (const symbol of symbols) {
                tbody.append(`
                    <tr>
                      <td class="text-center">${symbol.symbol}</td>
                      <td>${symbol.description}</td>
                      <td class="text-center">${symbol.currency}</td>
                      <td class="table-actions text-center">
                        <button class="btn btn-success btn-sm" onclick="addToWatchlist('${symbol.symbol}')">Add to Watch List</button>
                      </td>
                    </tr>`);
            }

            renderPagination(res.total, res.page);
        });
    }

    function renderPagination(totalPages, current) {
        const myPagination = $('#pagination');
        const limit = $('#limitSelect');

        myPagination.pagination('destroy');

        myPagination.pagination({
            items: totalPages,
            itemsOnPage: parseInt(limit.val(), 10),
            currentPage: current + 1,
            cssStyle: 'light-theme',
            onPageClick: function (pageNumber) {
                loadSymbols(pageNumber - 1);
            }
        });

        myPagination.pagination('redraw');
    }

    function addToWatchlist(symbol) {
        alert("Added " + symbol + " to watch list!");
    }

    $(document).ready(function () {
        loadSymbols();

        $('#searchInput').on('keypress', function (e) {
            if (e.which === 13) {
                loadSymbols(0);
            }
        });

        $('#limitSelect').change(function () {
            loadSymbols(0);
        });
    });
</script>
</body>
</html>
